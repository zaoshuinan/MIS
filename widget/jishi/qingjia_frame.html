<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<style type="text/css">
body {
    height: auto;
}
.aui-content-padded {
    padding-top: 15px;
}
.aui-btn-block {
    margin-bottom: 15px;
}
.aui-nav{
    background-color: #3e6491;
    color: #ffffff;
    text-align: center;
    line-height: 50px;
}
</style>
<body>
    <div class="aui-content aui-card aui-noborder">       
        <div class="aui-form" style="margin-top:30px;">
            <p style="font-size: 18px;" class="aui-text-danger">起始日期：</p>
            <div class="aui-input-row">
                <span class="aui-input-addon">选择</span>
                <input type="text" class="aui-input" placeholder="点击选择起始日期" id="startDay" readonly tapmode onclick="openPicker()" />
            </div>
            <p style="font-size: 18px;" class="aui-text-danger">请假天数：<b id="qingdiaDay">0</b>天</p>
            <div class="aui-input-row">
                <span class="aui-input-addon">天数</span>
                <div class="aui-pull-left">
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(0.5)" id="shichang1" value="0.5"> <span class="aui-radio-name">0.5</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(1)" id="shichang2" value="1"> <span class="aui-radio-name">1</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(2)" id="shichang3" value="2"> <span class="aui-radio-name">2</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(3)" id="shichang4" value="3"> <span class="aui-radio-name">3</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(4)" id="shichang5" value="4"> <span class="aui-radio-name">4</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="shichang" onclick="changeShichang(5)" id="shichang6" value="5"> <span class="aui-radio-name">5</span>
                </div>
            </div>
            <p style="font-size: 18px;" class="aui-text-danger">请假原因：<b id="qingjiaYuanyin">无</b></p>
            <div class="aui-input-row">
                <div>
                    <input class="aui-radio aui-radio-danger" type="radio" name="yuanyin" onclick="changeYuanyin(1)" id="yuanyin1" value="1"> <span class="aui-radio-name">例行休假</span>
                </div>
                <div>
                    <input class="aui-radio aui-radio-danger" type="radio" name="yuanyin" onclick="changeYuanyin(2)" id="yuanyin2" value="2"> <span class="aui-radio-name">病假</span>
                </div>
                <div>
                    <input class="aui-radio aui-radio-danger" type="radio" name="yuanyin" onclick="changeYuanyin(3)" id="yuanyin3" value="3"> <span class="aui-radio-name">事假</span>
                </div>
                <div>
                    <input class="aui-radio aui-radio-danger" type="radio" name="yuanyin" onclick="changeYuanyin(4)" id="yuanyin4" value="4"> <span class="aui-radio-name">其他</span>
                </div>

            </div>
            <p style="font-size: 18px;" class="aui-text-danger">是否了解请假对工资的影响？<b id="zhixiao">无</b></p>
            <div class="aui-input-row">
                <div>
                    <div class="aui-pull-left">
                        <input class="aui-radio aui-radio-danger" type="radio" name="hasknow" onclick="hasKnow(1)" value="1"> <span class="aui-radio-name">已了解</span>
                        <input class="aui-radio aui-radio-danger" type="radio" name="hasknow" onclick="hasKnow(2)" value="2"> <span class="aui-radio-name">未了解</span>
                    </div>
                </div>
            </div>
            <p id="qingjiaShuoming">每月(1号起算)有两天例行假期，超过例行假期天数将依规定扣除部分工资，扣除标准为：1天300元</p>
            <p>请假由钟房负责人审批，并由负责人判断是否超出例行假期天数</p>
    </div>
    <footer class="aui-nav" id="aui-footer">
        <div class="aui-col-xs-12" id="saveBtn">
            <button class="aui-btn aui-btn-danger aui-btn-block" tapmode onclick="checkQingjia()">确定请假</button>
        </div>
    </footer>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript" src="../script/function.js" ></script>
<script type="text/javascript" src="../script/laytpl.js" ></script>
<script type="text/javascript">
var startDay = '';
var shichang = yuanyinId = knowId = 0;
var yuanyinStr = '';
var canSend = 1;
var yuanyinArr = ['无','例行休假','病假','事假','其他'];
var knowArr = ['无','已了解','未了解'];
var companyId = $api.getStorage('companyId');
var userId = $api.getStorage('userId');
var userType = $api.getStorage('userType');
var jishiId = $api.getStorage('jishiId');
var jishiPaihao = $api.getStorage('jishiPaihao');
var userTel = $api.getStorage('userTel');
var missionDay = $api.getStorage('missionDay');
//alert($api.getStorage('userType'))
function openPicker(){
    api.openPicker({
        type: 'date',
        date: missionDay,
        title:'选择日期'
    },function(ret,err){
        var year = ret.year;
        var month = ret.month;
        var day = ret.day;
        if(month < 10){
            month = '0'+ month
        }
        if(day < 10){
            day = '0'+ day
        }
        startDay = year+'-'+month+'-'+day;
        $api.val($api.byId("startDay"),startDay);

    });
}
function changeShichang(index){
    shichang = index;
    $api.html($api.byId('qingdiaDay'), shichang);
}
function changeYuanyin(index){
    yuanyinId = index;
    yuanyinStr = yuanyinArr[yuanyinId];
    $api.html($api.byId('qingjiaYuanyin'), yuanyinStr);
}
function hasKnow(index){
    knowId = index;
    $api.html($api.byId('zhixiao'), knowArr[knowId]);
}
function checkQingjia(){
    if(startDay == ''){
        api.toast({
            msg: '请务必选择起始日期！'
        });
        canSend = 0;
        return false;
    }
    if(shichang == 0 || yuanyinId == 0){
        api.toast({
            msg: '还有未选择选项，请补充完整！'
        });
        canSend = 0;
        return false;
    }

    if(knowId != 1){
        api.toast({
            msg: '请确认已了解请假规章制度'
        });
        canSend = 0;
        return false;
    }
    if(canSend == 1){
        api.confirm({
            title: '确认信息',
            msg: '你确定要请假'+shichang+'天吗？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret) {
                if(ret.buttonIndex == 1){
                    sendQingjia();
                }
            }
        });
        
    }
}
function sendQingjia(){
    api.ajax({
        url: appUrl+'Add/newQingjia',
        method: 'post',
        data: {
            values: { 
                company_id:companyId,
                user_id:userId,
                user_name:jishiPaihao,
                user_tel:userTel,
                jishi_id:jishiId,
                user_type:userType,
                start_day:startDay,
                shichang:shichang,
                yuanyin:yuanyinStr
            }
        }
    }, function(ret, err) {
        if (ret) {
            alert('请假成功，具体将由钟房主管批复，请在请假历史中查看请假批准状态');
            api.closeWin();
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}


apiready = function(){
    api.parseTapmode();
}
        
</script>
</html>