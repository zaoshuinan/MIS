<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<body>
    <div class="aui-content-padded icons" style="padding-top: 20px;">
        <ul class="aui-grid-nine" id="viewBox1">
            <li class="aui-col-xs-12 aui-text-center" tapmode onclick="selectLeixing()"><img src="../image/yuangong.png" style="width:60px"><p>点击选择查看技师数据时间类型</p></li>
        </ul>
    </div>
    <div class="aui-content-padded icons">
        <ul class="aui-grid-nine" id="selectTimeBox">
            <p style="text-align: center;margin-top: 20px;margin-bottom: 20px; font-size: 20px;">请选择查看类型</p>
        </ul>
    </div>

    <div class="aui-content-padded icons aui-hidden" id="detailBox" style="padding-top: 20px;">
        <ul class="aui-grid-nine" id="viewBox">
            
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript" src="../script/laytpl.js" ></script>
<script type="text/javascript">
var thisYear,thisMonth,thisDay;
var thisDataType = 1;
var selectDate = selectDateStr = selectStartDate = selectStartDateStr = selectEndDate = selectEndDateStr = '';
var thisLeixing = 0;
var hasSelectStartDate = 0;
var missionDay = $api.getStorage('missionDay');
var userName = $api.getStorage('userName');
var colorArr = ['#d81e06','#4bc344','#1296db'];
var typeNameArr = ['公司','业务','工资'];
var iconArr = ['company1','yuangong','gongzi'];
var detailNameArr = [
    ['业务数据','考勤数据'],
    ['技师业务及提成'],
    ['技师提成']
]
var detailIconArr = [
    ['yewuliang','kaoqin1'],
    ['gongzi2'],
    ['jingli4']
]
var singleWinNameArr = [
    ['yewuliang_company_single','tongji_kaoqin_single'],
    ['ticheng_single'],
    ['ticheng_jingli_single']
]
var duanWinNameArr = [
    ['yewuliang_company_duan','tongji_kaoqin_duan'],
    ['tongji_jishi_duan'],
    ['ticheng_jingli_duan']
] 
function selectType(index){
    //$api.addCls($api.byId('selectTimeBox'), 'aui-hidden');
    hasSelectStartDate = 0;
    $api.addCls($api.byId('detailBox'), 'aui-hidden');
    thisLeixing = 0;
    var innerStr = '<li class="aui-col-xs-12 aui-text-center" tapmode onclick="selectLeixing()"><img src="../image/'+iconArr[index]+'.png" style="width:60px"><p>点击选择查看'+typeNameArr[index]+'数据时间类型</p></li>';
    thisDataType = index;
    $api.html($api.byId('selectTimeBox'), innerStr);
    //$api.removeCls($api.byId('selectTimeBox'), 'aui-hidden');
    //alert($api.offset($api.byId('selectTimeBox')).h);
}
function selectLeixing(){
    api.actionSheet({
        destructiveTitle:'单日数据',
        buttons: ['时间段(1个月内)']
    }, function(ret, err){
        if( ret ){
            if(ret.buttonIndex == 1){
                thisLeixing = 1;
                buildTimeBox()
            }
            if(ret.buttonIndex == 2){
                thisLeixing = 2;
                buildTimeBox();
            }
        }else{
             
        }
    });
}
function buildTimeBox(){
    var timeTypeArr = ['','单日数据','时间段'];
    if(thisLeixing == 2){
        var innerStr = '<li class="aui-col-xs-4 aui-text-center"><img src="../image/yuangong.png" style="width:60px"><p style="color:'+colorArr[thisDataType]+'">'+timeTypeArr[thisLeixing]+'</p></li><li class="aui-col-xs-4 aui-text-center" tapmode onclick="selectStartDay('+thisDataType+')" id="riqiStartBox"><img src="../image/riqi4.png" style="width:60px"><p>选择开始日期</p></li><li class="aui-col-xs-4 aui-text-center" tapmode onclick="selectEndDay('+thisDataType+')" id="riqiEndBox"><img src="../image/riqi4.png" style="width:60px"><p>选择结束日期</p></li>';
    }
    if(thisLeixing == 1){
        var innerStr = '<li class="aui-col-xs-6 aui-text-center"><img src="../image/yuangong.png" style="width:60px"><p style="color:'+colorArr[thisDataType]+'">'+timeTypeArr[thisLeixing]+'</p></li><li class="aui-col-xs-6 aui-text-center" tapmode onclick="selectSingleDay('+thisDataType+')" id="riqiBox"><img src="../image/riqi4.png" style="width:60px"><p>点击选择日期</p></li>';
    }

    $api.html($api.byId('selectTimeBox'), innerStr);
}
function selectSingleDay(){
    api.openPicker({
        type: 'date',
        date: '',
        title: '选择工作日'
    }, function(ret, err) {
        if (ret) {
            var selectYear = ret.year;
            var selectMonth = ret.month;
            var selectDay = ret.day;
           selectDateStr = String(selectYear).substring(2) + '年' + selectMonth + '月' + selectDay + '日';
           if(selectMonth < 10){
               selectMonth = '0' + selectMonth;
           }
           if(selectDay < 10){
               selectDay = '0' + selectDay;
           }
           selectDate = selectYear + '-' + selectMonth + '-' + selectDay;
           var d1 = new Date(missionDay.replace(/\-/g, "\/"));  
           var d2 = new Date(selectDate.replace(/\-/g, "\/")); 
           if(d1 <= d2){
               alert('选择时间需小于今天');
               return false;
           }else{
                $api.html($api.byId('riqiBox'), '<img src="../image/riqi'+thisDataType+'.png" style="width:60px"><p style="color:'+colorArr[thisDataType]+'">'+selectDateStr+'</p>');
                showDetailBox();
           }
        }
    });
}
function selectStartDay(){
    selectEndDate = '';
    $api.html($api.byId('riqiEndBox'), '<img src="../image/riqi4.png" style="width:60px"><p>选择结束日期</p>');
    $api.addCls($api.byId('detailBox'), 'aui-hidden');
    api.openPicker({
        type: 'date',
        date: '',
        title: '选择开始日期'
    }, function(ret, err) {
        if (ret) {
            var selectStartYear = ret.year;
            var selectStartMonth = ret.month;
            var selectStartDay = ret.day;
            selectStartDateStr = String(selectStartYear).substring(2) + '年' + selectStartMonth + '月' + selectStartDay + '日';
            if(selectStartMonth < 10){
                selectStartMonth = '0' + selectStartMonth;
            }
            if(selectStartDay < 10){
                selectStartDay = '0' + selectStartDay;
            }
            hasSelectStartDate = 1;
            selectStartDate = selectStartYear + '-' + selectStartMonth + '-' + selectStartDay;
            var d1 = new Date(missionDay.replace(/\-/g, "\/"));  
            var d2 = new Date(selectStartDate.replace(/\-/g, "\/")); 
            if(d1 <= d2){
                alert('选择时间需小于今天');
                return false;
            }
            $api.html($api.byId('riqiStartBox'), '<img src="../image/riqi'+thisDataType+'.png" style="width:60px"><p style="color:'+colorArr[thisDataType]+'">'+selectStartDateStr+'</p>');
        }
    });
}
function selectEndDay(){
    api.openPicker({
        type: 'date',
        date: '',
        title: '选择结束日期'
    }, function(ret, err) {
        if (ret) {
            var selectEndYear = ret.year;
            var selectEndMonth = ret.month;
            var selectEndDay = ret.day;
            selectEndDateStr = String(selectEndYear).substring(2) + '年' + selectEndMonth + '月' + selectEndDay + '日';
            if(selectEndMonth < 10){
                selectEndMonth = '0' + selectEndMonth;
            }
            if(selectEndDay < 10){
                selectEndDay = '0' + selectEndDay;
            }
            selectEndDate = selectEndYear + '-' + selectEndMonth + '-' + selectEndDay;
            var d3 = new Date(missionDay.replace(/\-/g, "\/"));  
            var d4 = new Date(selectEndDate.replace(/\-/g, "\/")); 
            if(d3 <= d4){
                alert('选择时间需小于今天');
                return false;
            }
            var d1 = new Date(selectStartDate.replace(/\-/g, "\/"));  
            var d2 = new Date(selectEndDate.replace(/\-/g, "\/")); 
            if(d1 >=d2){
                alert('开始时间不能等于或小于结束时间');
                return false;
            }else{
                var cha = d2 - d1
                var chaDay = cha / (60*60*24*1000)
                //alert(chaDay)
                if(chaDay > 31){
                    alert('时间段相隔大于1个月，请重新选择！');
                    return false;
                }else{
                    $api.html($api.byId('riqiEndBox'), '<img src="../image/riqi'+thisDataType+'.png" style="width:60px"><p style="color:'+colorArr[thisDataType]+'">'+selectEndDateStr+'</p>');
                    showDetailBox()
                }
            }
        }
    });
}
function showDetailBox(){
    var innerStr = '';
    var buttonNum = detailNameArr[1].length;
    if(buttonNum == 1){
        var classLong = 12;
    }
    if(buttonNum == 2){
        var classLong = 6;
    }
    if(buttonNum == 3){
        var classLong = 4;
    }
    if(buttonNum == 4){
        var classLong = 2;
    }
    for(var i = 0;i < buttonNum;i++){
        var thisButtonName = detailNameArr[1][i];
        var thisButtonIcon = detailIconArr[1][i];
        var thisStr = '<li class="aui-col-xs-'+classLong+' aui-text-center" tapmode onclick="openWin('+i+')"><img src="../image/'+thisButtonIcon+'.png" style="width:60px"><p style="color:'+colorArr[1]+'">'+thisButtonName+'</p></li>'
        innerStr += thisStr;
    }
    $api.html($api.byId('viewBox'), innerStr);
    $api.removeCls($api.byId('detailBox'), 'aui-hidden');
}
function openWin(index){
    var pageParamJson = {};
    var winName = '';
    //alert(selectDate)
    if(thisLeixing == 1){
        pageParamJson = {
            isToday : 0,
            showDate : selectDate
        }
        winName = singleWinNameArr[thisDataType][index];
        var msgStr = '你需要查看'+selectDate+'的'+detailNameArr[thisDataType][index]+'数据，确定吗?';
    }
    if(thisLeixing == 2){
        pageParamJson = {
            startDate : selectStartDate,
            endDate : selectEndDate,
            userType:0,
            userName:userName
        }
        winName = duanWinNameArr[thisDataType][index];
        var msgStr = '你需要查看'+selectStartDate+'至'+selectEndDate+'的'+detailNameArr[thisDataType][index]+'数据，确定吗?';
    }
    api.confirm({
        title: '确认信息',
        msg: msgStr,
        buttons: ['确定', '取消']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: winName,
                    url: './'+winName+'_win.html',
                    pageParam: pageParamJson
                });
            }
        } 
    });
}
apiready = function(){
    //alert(JSON.stringify(serviceJson));
    api.parseTapmode();
}  
</script>
</html>