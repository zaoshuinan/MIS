<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<style type="text/css">
body {
    height: auto;
}
.aui-content-padded {
    padding-top: 15px;
}
.aui-btn-block {
    margin-bottom: 15px;
}
.aui-nav{
    background-color: #3e6491;
    color: #ffffff;
    text-align: center;
    line-height: 50px;
}
</style>
<body>
    <div class="aui-content-padded icons">
        <ul class="aui-grid-nine" id="viewBox">
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript" src="../script/function.js" ></script>
<script type="text/javascript">
var configId,typeName,typeHang,typeLie,fanweiId;
var roomBoxClass;
var lieZimuArr = ['A','B','C','D','E','F'];
var innerStr = '';
var allRoomHaomaStr = '';
var companyId = $api.getStorage('companyId');
var roomJson;
function getData(){
    for(var i = 1;i <= typeHang;i++){
        for(var j = 0;j < typeLie;j++){
            var thisHaoma = lieZimuArr[j]+i;
            if(allRoomHaomaStr == ''){
                allRoomHaomaStr = thisHaoma;
            }else{
                allRoomHaomaStr += ',' + thisHaoma;
            }
        }
    }
    var valueJson = { 
        company_id: companyId,
        room_haoma_str:allRoomHaomaStr,
        config_id:configId,
        type_id:fanweiId
    }
    // alert(JSON.stringify(valueJson));
    // return false;
    api.ajax({
        url: appUrl+'Add/room',
        method: 'post',
        data: {
            values: valueJson
        }
    }, function(ret, err) {
        if (ret) {
            roomJson = ret.data;
            //alert(JSON.stringify(roomJson))
            buildPage()
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
function buildPage(){
    for(var i = 1;i <= typeHang;i++){
        for(var j = 0;j < typeLie;j++){
            var thisHaoma = lieZimuArr[j]+i;
            //alert(thisHaoma)
            var thisRoomId = roomJson[thisHaoma]['id'];
            var thisRoomName = roomJson[thisHaoma]['name'];
            if(thisRoomName == ''){
                var nameStr = '无';
            }else{
                var nameStr = thisRoomName;
            }
            //alert(thisRoomName + thisRoomId)
            var thisStr = '<li id="box'+thisRoomId+'" class="'+roomBoxClass+' aui-text-center" tapmode onclick="reName(\''+thisHaoma+'\',\''+thisRoomId+'\')"><p style="color:black">'+thisHaoma+'</p><p style="color:blue" id="roomName'+thisRoomId+'">'+nameStr+'</p></li>';
            innerStr += thisStr;
        }
    }
    $api.html($api.byId('viewBox'), innerStr);
}
function addEvent(){
    api.addEventListener({
        name: 'setRoomName'
    }, function(ret, err) {
        if (ret) {
            //alert(JSON.stringify(ret));
            var roomName = ret.value.roomName;
            var roomId = ret.value.roomId;
            $api.html($api.byId('roomName'+roomId), roomName);
        }
    });
}
function sendEvent(roomHaoma,roomId){
    var roomName = $api.html($api.byId('roomName'+roomId));
    if(roomName == '无'){
        roomName = '';
    }
    api.sendEvent({
        name: 'selectRoom',
        extra: {
            roomHaoma: roomHaoma, 
            roomId: roomId,
            roomName:roomName
        }
    });
}
function reName(roomHaoma,roomId,roomName){
    var liObjs = $api.domAll($api.byId('viewBox'), 'li');
    for(var i = 0;i < liObjs.length;i++){
        var thisLiObj = liObjs[i];
        $api.removeCls(thisLiObj, 'aui-bg-danger');
    }
    $api.addCls($api.byId('box'+roomId), 'aui-bg-danger');
    sendEvent(roomHaoma,roomId,roomName);
}
apiready = function(){
    api.parseTapmode();
    fanweiId = api.pageParam.fanweiId;
    configId = api.pageParam.configId;
    typeName = api.pageParam.typeName;
    typeHang = api.pageParam.typeHang;
    typeLie = api.pageParam.typeLie;
    if(typeLie == 1){
        roomBoxClass = 'aui-col-xs-12';
    }
    if(typeLie == 2){
        roomBoxClass = 'aui-col-xs-6';
    }
    if(typeLie == 3){
        roomBoxClass = 'aui-col-xs-4';
    }
    if(typeLie == 4){
        roomBoxClass = 'aui-col-xs-3';
    }
    if(typeLie == 5){
        roomBoxClass = 'aui-col-5';
    }
    if(typeLie == 6){
        roomBoxClass = 'aui-col-xs-2';
    }
    addEvent()
    getData();
}       
</script>
</html>