<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<style type="text/css">
body {
    height: auto;
}
.aui-content-padded {
    padding-top: 15px;
}
.aui-btn-block {
    margin-bottom: 15px;
}
.aui-nav{
    background-color: #3e6491;
    color: #ffffff;
    text-align: center;
    line-height: 50px;
}
</style>
<body>
    <div class="aui-content aui-card aui-noborder">       
        <div class="aui-form" style="margin-top:20px;">
            <div class="aui-input-row">
                <span class="aui-input-addon  aui-text-danger">技师手机</span>
                <input type="number" class="aui-input" id="userTel" placeholder="手机号码" value="" />
            </div>
            <div class="aui-input-row">
                <span class="aui-input-addon">技师名称</span>
                <input type="text" class="aui-input" id="userName" placeholder="技师名称"/>
            </div>
            <div class="aui-input-row">
                <span class="aui-input-addon  aui-text-danger">技师牌号</span>
                <input type="text" class="aui-input" id="jishiPaihao" placeholder="技师牌号"/>
            </div>
            <div class="aui-input-row">
                <span class="aui-input-addon">性别</span>
                <div class="aui-pull-left">
                    <input class="aui-radio aui-radio-info" type="radio" name="sex" id="man" onclick="changeSex(0)"> <span class="aui-radio-name">男</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="sex" id="women" checked onclick="changeSex(1)"> <span class="aui-radio-name">女</span>
                </div>
            </div>
            <div class="aui-input-row">
                <span class="aui-input-addon  aui-text-danger">服务类别</span>
                <div class="aui-pull-left">
                    <input class="aui-radio aui-radio-info" type="radio" name="jishiType" id="muzu" checked onclick="changeType(0)"> <span class="aui-radio-name">沐足</span>
                    <input class="aui-radio aui-radio-danger" type="radio" name="jishiType" id="anmo" onclick="changeType(1)"> <span class="aui-radio-name">按摩</span>
                    <input class="aui-radio aui-radio-success" type="radio" name="jishiType" id="sangna"  onclick="changeType(2)"> <span class="aui-radio-name">桑拿</span>
                </div>
            </div>
            <p class="aui-padded-10  aui-text-danger">
                初始密码为“123456”，提醒用户登录后修改密码！
            </p>
        </div>
    </div>
    <footer class="aui-nav" id="aui-footer">
        <div class="aui-col-xs-12" id="saveBtn">
            <button class="aui-btn aui-btn-danger aui-btn-block" id="buttonBox" tapmode onclick="saveCheck()">增加技师账号</button>
        </div>
    </footer>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript" src="../script/function.js" ></script>
<script type="text/javascript" src="../script/md5.js" ></script>
<script type="text/javascript">
var showType,userId,jishiId;
var companyId = $api.getStorage('companyId');
var canOpen = 0;
var sex = 1;
var jishiType = 0;
var userArr = new Array();
function changeSex(index){
    sex = index;
}
function changeType(index){
    jishiType = index;
}
function saveCheck(){
    var canSend = 1;
    var userName = $api.val($api.byId('userName'));
    var userTel = $api.val($api.byId('userTel'));
    var userSex = sex;
    var jishiPaihao = $api.val($api.byId('jishiPaihao'));
    
    if(userTel == ''){
        api.toast({
            msg: '还没有输入电话号码！'
        });
        canSend = 0;
    }
    if(userTel.length != 11){
        api.toast({
            msg: '请输入11位手机号码！'
        });
    }
    if(parseInt(userTel) < 10000000000){
        api.toast({
            msg: '手机号码输入有误！'
        });
        canSend = 0;
    }
    if(jishiPaihao == ''){
        api.toast({
            msg: '请务必输入技师牌号'
        });
        canSend = 0;
    }
    if(jishiPaihao.length > 5){
        api.toast({
            msg: '牌号不要超过5位'
        });
        canSend = 0;
    }
    if(canSend == 1){
        //alert(showType)
        if(showType == 0){
            addInfo(userTel,userName,jishiPaihao);
        }else{
            saveInfo(userTel,userName,jishiPaihao);
        }
    }
}
function sendEvent(){
    api.sendEvent({
        name: 'jishiList',
        extra: {
            showType: showType
        }
    });
}
function saveInfo(userTel,userName,jishiPaihao){
    var userPassword = 'e10adc3949ba59abbe56e057f20f883e';
    api.ajax({
        url: appUrl+'Change/jishiInfo',
        method: 'post',
        data: {
            values: {
                user_name:userName,
                user_sex:sex,
                user_tel:userTel,
                user_password:userPassword,
                user_type:9,
                company_id:companyId,
                jishi_paihao:jishiPaihao,
                jishi_type:jishiType,
                jishi_id:jishiId,
                user_id:userId
            }
        }
    }, function(ret, err) {
        if (ret) {
            sendEvent();
            alert('修改技师成功');
            api.closeWin();
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
function addInfo(userTel,userName,jishiPaihao){
    userPassword = 'e10adc3949ba59abbe56e057f20f883e';
    api.ajax({
        url: appUrl+'Add/jishiInfo',
        method: 'post',
        data: {
            values: {
                user_name:userName,
                user_sex:sex,
                user_tel:userTel,
                user_password:userPassword,
                user_type:9,
                company_id:companyId,
                jishi_paihao:jishiPaihao,
                jishi_type:jishiType
            }
        }
    }, function(ret, err) {
        if (ret) {
            if(ret.has == 1){
                alert('已有重复数据！');
                return false;
            }
            if(ret.has == 0){
                $api.setStorage('changeCache', '1');
                alert('新增技师成功');
                api.closeWin();
            }
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
function buildPage(){
    //alert(JSON.stringify(userArr))
    $api.val($api.byId('userTel'), userArr['user_tel']);
    $api.val($api.byId('userName'), userArr['user_name']);
    $api.val($api.byId('jishiPaihao'), userArr['jishi_paihao']);
    sex = parseInt(userArr['user_sex']);
    jishiType = parseInt(userArr['jishi_type']);
    if(sex == 0){
        $api.attr($api.byId('man'), 'checked', 'checked');
        $api.removeAttr($api.byId('women'), 'checked');
    }else{
        $api.attr($api.byId('women'), 'checked', 'checked');
        $api.removeAttr($api.byId('man'), 'checked');
    }
    if(jishiType == 0){
        $api.attr($api.byId('muzu'), 'checked', 'checked');
        $api.removeAttr($api.byId('anmo'), 'checked');
        $api.removeAttr($api.byId('sangna'), 'checked');
    }
    if(jishiType == 1){
        $api.attr($api.byId('anmo'), 'checked', 'checked');
        $api.removeAttr($api.byId('muzu'), 'checked');
        $api.removeAttr($api.byId('sangna'), 'checked');
    }
    if(jishiType == 2){
        $api.attr($api.byId('sangna'), 'checked', 'checked');
        $api.removeAttr($api.byId('anmo'), 'checked');
        $api.removeAttr($api.byId('muzu'), 'checked');
    }
}
function buildPageByJson(){
    api.ajax({
        url: appUrl+'Get/jishiInfoByZhongfang',
        method: 'post',
        data: {
            values: { 
                company_id: companyId,
                user_id:userId,
                jishi_id:jishiId
            }
        }
    }, function(ret, err) {
        //alert(JSON.stringify(ret))
        if (ret) {
            if(ret.has == 1){
                userArr = ret.data;
                buildPage();
            }
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
apiready = function(){
    api.parseTapmode();
    showType = api.pageParam.showType;
    userId = api.pageParam.userId;
    jishiId = api.pageParam.jishiId;
    if(showType == 0){
        $api.html($api.byId('buttonBox'), '增加技师账号');
    }else{
        buildPageByJson();
        $api.html($api.byId('buttonBox'), '修改技师信息');
    }
}
        
</script>
</html>