<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<body>
    
    <div class="aui-content" style="padding-top:30px;">
        <div class="aui-card aui-hidden" id="managerBox">
            <p style="font-size: 16px" class="aui-padded-10">服务活动管理</p>
            <ul class="aui-grid-sixteen">
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenChongzhi()">
                    <span class="aui-iconfont aui-icon-pay aui-text-danger"></span>
                    <p>充值优惠管理</p>
                </li>
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenHuodong()">
                    <span class="aui-iconfont aui-icon-redpacket aui-text-danger"></span>
                    <p>活动优惠管理</p>
                </li>
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenConfig()">
                    <span class="aui-iconfont aui-icon-settings aui-text-danger"></span>
                    <p>参数设置</p>
                </li>
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenYichang()">
                    <span class="aui-iconfont aui-icon-warn aui-text-danger"></span>
                    <p>异常处理</p>
                </li>
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenHuiyuan()">
                    <span class="aui-iconfont aui-icon-vip aui-text-danger"></span>
                    <p>查看会员</p>
                </li>
                <li class="aui-col-xs-4 aui-text-center" tapmode onclick="fnOpenGongzi()">
                    <span class="aui-iconfont aui-icon-recharge aui-text-danger"></span>
                    <p>工资发放</p>
                </li>
            </ul>
        </div>
        <div class="aui-card aui-hidden" id="systemSwitchBox" style="margin-top:30px;">
            
        </div>
        <div class="aui-content aui-card" id="passwordBox"> 
            <p style="font-size: 16px" class="aui-padded-10">输入密码才能进入管理页面</p>      
            <div class="aui-form">
                <div class="aui-input-row">
                    <i class="aui-input-addon aui-iconfont aui-icon-lock aui-text-warning"></i>
                    <input type="password" id="password" class="aui-input" placeholder="请输入密码"/>
                    <i class="aui-input-addon aui-iconfont aui-icon-attention aui-text-default" tapmode onclick="showPassword();" id="showpass-btn"></i>
                </div>
                <div class="aui-btn-row">
                    <div class="aui-btn aui-btn-block aui-btn-danger" onclick="checkPassword()">验证密码</div>
                </div>
                <p style="text-align: center;" tapmode onclick="openWin(0)">修改密码</p>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript">
var companyId = $api.getStorage('companyId');
var missionDay = $api.getStorage('missionDay');
var shebeiType = parseInt($api.getStorage('shebeiType'));
var shebeiId = $api.getStorage('shebeiId');
var shebeiPassword = $api.getStorage('shebeiPassword');
function fnOpenYichang(){
    alert('开发中');
}
function fnOpenHuiyuan(){
    alert('开发中');
}
function fnOpenGongzi(){
    api.actionSheet({
        destructiveTitle: '工资发放列表',
        buttons: ['创建新工资单']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'addGongzi',
                    url: './add_gongzi_win.html',
                    pageParam: {
                        showType: 0
                    }
                });
            }
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'showGongzi',
                    url: './show_gongzi_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
        }
    });
}
function openWin(index){
    var winNameArr = ['change_shebei_password'];
    api.openWin({
        name: winNameArr[index],
        url: './' + winNameArr[index] + '_win.html',
        pageParam: {
            name: 'value'
        }
    });
}
function showOpen(){
    $api.html($api.byId('systemSwitchBox'), '<ul class="aui-grid-sixteen"><li class="aui-col-xs-12 aui-text-center aui-bg-danger" style="padding:50px;" tapmode onclick="fnCloseSystem()"><span class="aui-iconfont aui-icon-videofill aui-text-warning"></span><p style="font-size:20px;color:black">系统正在运行，点击关闭系统!</p></li></ul>');
}
function showClose(){
    $api.html($api.byId('systemSwitchBox'), '<ul class="aui-grid-sixteen"><li class="aui-col-xs-12 aui-text-center aui-bg-info" style="padding:50px;" tapmode onclick="fnOpenSystem()"><span class="aui-iconfont aui-icon-radiobox aui-text-danger"></span><p style="font-size:20px;color:black">系统已经关闭，点击开启系统！</p></li></ul>');
}
function checkPassword(){
    var password = $api.val($api.byId('password'));
    if(password == ''){
        alert('请输入密码');
        return false;
    }
    if(shebeiPassword == password){
        canShow = 1;
        changeShow()
    }else{
        alert('输入密码不正确，请重新输入')
    }
}
function changeShow(){
    if(canShow == 0){
        $api.removeCls($api.byId('passwordBox'), 'aui-hidden');
        $api.addCls($api.byId('managerBox'), 'aui-hidden');
        $api.addCls($api.byId('systemSwitchBox'), 'aui-hidden');
    }
    if(canShow == 1){
        $api.removeCls($api.byId('managerBox'), 'aui-hidden');
        $api.removeCls($api.byId('systemSwitchBox'), 'aui-hidden');
        $api.addCls($api.byId('passwordBox'), 'aui-hidden');
    }
}
function showcompanyStatus(){
    if($api.getStorage('companyStatus') == 0){
        showClose();
    }else{
        showOpen();
    }
}
function switchSystemWin(index){
    var winName = 'system_switch';
    api.openWin({
        name: winName,
        url: './' + winName + '_win.html',
        pageParam: {
            showType: index
        }
    });
}
function fnOpenSystem(){
    api.confirm({
        title: '确认信息',
        msg: '确认要开启系统吗？',
        buttons: ['确定', '取消']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                switchSystemWin(1);
            }
        }
    });
}
function fnCloseSystem(){
    api.confirm({
        title: '确认信息',
        msg: '确认要关闭系统吗？',
        buttons: ['确定', '取消']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                switchSystemWin(0);
            }
        }
    });
}
function checkSystem(){
    api.ajax({
        url: appUrl+'Get/checkSystemByQiantai',
        method: 'post',
        data: {
            values: { 
                company_id: companyId,
                mission_day:missionDay
            }
        }
    }, function(ret, err) {
        if (ret) {
            if(ret.has == 1){
                closeSystem();
            }
            if(ret.has == 0){
                showOpen();
                alert('还有订单正在进行中，无法关闭系统')
                return false;
            }
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
function openConfig(){
    api.openWin({
        name: 'setConfig',
        url: './set_config_win.html',
        pageParam: {
            name: 'value'
        }
    });
}
function fnOpenConfig(){
    if($api.getStorage('companyStatus') == 1){
        api.confirm({
            msg: '系统正在运行中，所有修改将在下次系统启动时生效，确认修改吗？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret) {
                if(ret.buttonIndex == 1){
                    openConfig()
                }
            }
        });
    }else{
        openConfig()
    } 
}
function openChongzhi(){
    api.actionSheet({
        destructiveTitle: '添加充值优惠',
        buttons: ['管理充值优惠']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'addChongzhi',
                    url: './add_chongzhi_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'showChongzhi',
                    url: './show_chongzhi_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
        } 
    });
}
function fnOpenChongzhi(){
    if($api.getStorage('companyStatus') == 1){
        api.confirm({
            msg: '系统正在运行中，所有修改将在下次系统启动时生效，确认修改吗？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret) {
                if(ret.buttonIndex == 1){
                    openChongzhi()
                }
            }
        });
    }else{
        openChongzhi()
    } 
}
function openHuodong(){
    api.actionSheet({
        destructiveTitle: '添加活动优惠',
        buttons: ['管理活动优惠']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'addHuodong',
                    url: './add_huodong_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'showHuodong',
                    url: './show_huodong_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
        } 
    });
}
function fnOpenHuodong(){
    if($api.getStorage('companyStatus') == 1){
        api.confirm({
            msg: '系统正在运行中，所有修改将在下次系统启动时生效，确认修改吗？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret) {
                if(ret.buttonIndex == 1){
                    openHuodong()
                }
            }
        });
    }else{
        openHuodong()
    } 
}
apiready = function(){
    showcompanyStatus();
    api.addEventListener({
        name: 'systemSwitchOver'
    }, function(ret, err) {
        if (ret) {
            showcompanyStatus()
        }
    });
}   
</script>
</html>