<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/loading.css" />
    
</head>
<body>
    <div class="aui-card" id="showBox">
        <div style="text-align: center;padding: 50px;">
            <div class="loading-2">
                <i></i>
                <i></i>
                <i></i>
                <i></i>
                <i></i>
            </div>
            <p>读取数据中....</p>
        </div>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript">
var headerHeight,frameHeight,buttonBoxHeight,gotoType,startDate,endDate;
var banciJson = $api.getStorage('cacheBanci');
var missionDay = $api.getStorage('missionDay');
var companyId = $api.getStorage('companyId');
var banciNameArr = banciIdArr = new Array();

function getBanci(){
    for(var key in banciJson){
        var thisBanciJson = banciJson[key];
        var thisBanciName = thisBanciJson.banci_name;
        var thisBanciId = thisBanciJson.id;
        banciNameArr.push(thisBanciName);
        var banciKey = 'banci' + thisBanciId;
        banciIdArr[banciKey] = thisBanciName;
    }
    setTimeout('getJishi()',10);
}

function getJishi(){
    var showBox = $api.byId('showBox');
    var loadingStr = '<div class="loading-2" style="text-align: center;margin-top:20px;padding-top: 30px;"><i></i><i></i><i></i><i></i><i></i></div><p style="text-align: center;padding-bottom: 30px;">读取数据中....</p>';
    $api.html(showBox,loadingStr);
    api.ajax({
        url: appUrl+'Get/jishiByBoss',
        method: 'post',
        data: {
            values: { 
                company_id: companyId,
                banci_id:0
            }
        }
    }, function(ret, err) {
        if (ret) {
            if(ret.has == 0){
                $api.html(showBox,'<p style="text-align: center;padding-top: 30px;padding-bottom: 30px;">没有找到数据</p>');
            }else{
                var jishiArr = ret.data;
                var jishiListStr = '<ul class="aui-list-view"></ul>';
                for(var i = 0;i < jishiArr.length;i++){
                    var thisJishi = jishiArr[i];
                    var jishiId = thisJishi.jishi_id;
                    var userId = thisJishi.id;
                    var jishiName = thisJishi.jishi_paihao;
                    var jishiTel = thisJishi.user_tel;
                    var banciId = thisJishi.user_banci_id;
                    var banciKey = 'banci' + banciId;
                    var banciName = banciIdArr[banciKey];
                    jishiListStr += '<li class="aui-list-view-cell" tapmode onclick="openJishiDetail(\''+userId+'\',\''+jishiId+'\',\''+jishiName+'\',\''+jishiTel+'\')"><a>'+jishiName+'号（'+banciName+'）<span class="aui-badge aui-badge-warning">'+jishiTel+'</span></a></li>';
                }
                jishiListStr += '</ul>';
                $api.html(showBox,jishiListStr);
            }
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
function openJishiDetail(userId,jishiId,jishiName,jishiTel){
    var winNameArr = ['jishi_kaoqin_duan','jishi_tongji_duan','jishi_ticheng_duan'];
    if(gotoType == 1){
        api.openWin({
            name: winNameArr[0],
            url: './'+winNameArr[0]+'_win.html',
            pageParam: {
                userId:userId,
                jishiId:jishiId,
                jishiName:jishiName,
                jishiTel:jishiTel,
                startDate:startDate,
                endDate:endDate
            }
        });
    }
    if(gotoType == 2){
        api.openWin({
            name: winNameArr[1],
            url: './'+winNameArr[1]+'_win.html',
            pageParam: {
                userId:userId,
                jishiId:jishiId,
                jishiName:jishiName,
                jishiTel:jishiTel,
                startDate:startDate,
                endDate:endDate
            }
        });
    }
    if(gotoType == 3){
        api.openWin({
            name: winNameArr[2],
            url: './'+winNameArr[2]+'_win.html',
            pageParam: {
                userId:userId,
                jishiId:jishiId,
                jishiName:jishiName,
                jishiTel:jishiTel,
                startDate:startDate,
                endDate:endDate
            }
        });
    }
}
apiready = function(){
    api.parseTapmode();
    gotoType = api.pageParam.gotoType;
    startDate = api.pageParam.startDate;
    endDate = api.pageParam.endDate;
    getBanci();
}
    
</script>
</html>