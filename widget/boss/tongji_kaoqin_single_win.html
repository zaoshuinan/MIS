<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style type="text/css">
        .aui-grid-sixteen:after {
            border:none;
        }
        .aui-grid-sixteen li:after {
            border:none;
        }
        .aui-grid-sixteen li .aui-iconfont {
            color: #ffffff;
            width: 38px;
            height: 38px;
            line-height: 38px;
            border-radius: 50%;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <header class="aui-bar aui-bar-nav aui-bar-danger" id="misHeader">
        <a class="aui-btn aui-pull-left aui-bar-danger" id="backBtn" tapmode onclick="closeWin()">
            <span class="aui-iconfont aui-icon-left"></span>
        </a>
        <div class="aui-title" id="zhName"></div>
        <a class="aui-iconfont aui-icon-menu aui-pull-right"></a>
    </header>
    <div class="aui-card" id="showBox" style="margin-top:10px;">
        <p style="text-align: center;font-size: 16px;color:red;padding-top: 30px;" id="showTime">正在获取系统时间。。。</p>
        <p style="text-align: center;font-size: 16px;padding-top: 30px;padding-bottom: 30px;">根据你的需要，点击按钮查看数据</p>
    </div>
    <div class="aui-content-padded icons" style="padding-top: 10px;">
        <ul class="aui-grid-nine" id="viewBox">
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openBanciKaoqin(1)"><img src="../image/shangban.png" style="width:60px"><p>上班</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openBanciKaoqin(9)"><img src="../image/xiaban.png" style="width:60px"><p>下班</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openQingjia()"><img src="../image/qingjia1.png" style="width:60px"><p>请假</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openMaizhong()"><img src="../image/maizhong2.png" style="width:60px"><p>买钟</p></li>
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/mis.js"></script>
<script type="text/javascript" src="../script/function.js"></script>
<script type="text/javascript">
var header,headerHeight,frameHeight,buttonBoxHeight,showDate,titleStr;
var isToday;
var banciJson = $api.getStorage('cacheBanci');
var missionDay = $api.getStorage('missionDay');
var companyId = $api.getStorage('companyId');
var banciNameArr  = new Array();
var banciIdArr = new Array();
var banciBeginHourArr = new Array();
var banciJishiIdStrArr = new Array();
var banciJingliIdStrArr = new Array();
var groupIndex = 0;
function closeWin(){
    api.closeWin();
}
function reBuildBanci(){
    for(var key in banciJson){
        var thisBanciJson = banciJson[key];
        var thisBanciName = thisBanciJson.banci_name;
        var thisBanciId = thisBanciJson.id;
        var thisBanciBeginHour = parseInt(thisBanciJson.banci_begin_hour);
        if(thisBanciBeginHour < 10){
            thisBanciBeginHour = '0' + thisBanciBeginHour;
        }
        var thisBanciBeginMin = parseInt(thisBanciJson.banci_begin_min);
        if(thisBanciBeginMin < 10){
            thisBanciBeginMin = '0' + thisBanciBeginMin;
        }
        var thisBanciEndHour = parseInt(thisBanciJson.banci_end_hour);
        if(thisBanciEndHour < 10){
            thisBanciEndHour = '0' + thisBanciEndHour;
        }
        var thisBanciEndMin = parseInt(thisBanciJson.banci_end_min);
        if(thisBanciEndMin < 10){
            thisBanciEndMin = '0' + thisBanciEndMin;
        }
        var thisBanciJishiIdStr = thisBanciJson.jishi_id_str;
        var thisBanciJingliIdStr = thisBanciJson.jingli_id_str;
        thisBanciName += '('+thisBanciBeginHour+':'+thisBanciBeginMin+'~'+thisBanciEndHour+':'+thisBanciEndMin+')';
        banciNameArr.push(thisBanciName);
        banciIdArr.push(thisBanciId);
        banciBeginHourArr.push(thisBanciBeginHour);
        banciJingliIdStrArr.push(thisBanciJingliIdStr);
        banciJishiIdStrArr.push(thisBanciJishiIdStr);
    }
}
function openQingjia(){
    api.openWin({
        name: 'show_qingjia',
        url: './show_qingjia_win.html',
        pageParam: {
            isToday:isToday,
            showDate:showDate
        }
    });
}
function openBanciKaoqin(kaoqinStatus){
    var banciNum = banciNameArr.length;
    api.actionSheet({
        title: '选择班次',
        destructiveTitle: '全部',
        buttons: banciNameArr
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                //alert('选择了全部');
                openKaoqin('show_kaoqin','all',kaoqinStatus);
            }
            if(ret.buttonIndex >1 && ret.buttonIndex < 5){
                var banciKey = parseInt(ret.buttonIndex) - 2;
                openKaoqin('show_kaoqin',banciKey,kaoqinStatus);
                //alert('选择了第'+ret.buttonIndex+'个按钮，班次KEY是'+banciKey);
            }
        }
    });
}
function openMaizhong(){
    api.openWin({
        name: 'show_maizhong',
        url: './show_maizhong_win.html',
        pageParam: {
            isToday:isToday,
            showDate:showDate
        }
    });
}
function openKaoqin(winName,banciKey,kaoqinStatus){
    if(banciKey == 'all'){
        var banciId = 0;
        var banciName = '';
        var banciJingliIdStr = '';
        var banciJishiIdStr = '';
    }else{
        var banciId = banciIdArr[banciKey];
        var banciName = banciNameArr[banciKey];
        var banciJingliIdStr = banciJingliIdStrArr[banciKey];
        var banciJishiIdStr = banciJishiIdStrArr[banciKey];
    }
    api.openWin({
        name: winName,
        url: './'+winName+'_win.html',
        pageParam: {
            isToday:isToday,
            showDate:showDate,
            banciId: banciId,
            banciName:banciName,
            banciJingliIdStr:banciJingliIdStr,
            banciJishiIdStr:banciJishiIdStr,
            kaoqinStatus:kaoqinStatus
        }
    });
}
function getTime(){
    api.ajax({
        url: appUrl+'Get/timeNow',
        method: 'post',
        data: {
            values: { 
                valueName: 'value'
            }
        }
    }, function(ret, err) {
        if (ret) {
            var nowTime = ret.time;
            $api.html($api.byId('showTime'), '现在时间为：'+nowTime);
        } else {
            api.toast({
                msg: '网络错误'
            });
        }
    });
}
apiready = function(){
    api.parseTapmode();
    reBuildBanci();
    isToday = api.pageParam.isToday;
    if(isToday == 0){
        showDate = api.pageParam.showDate
        titleStr = '考勤数据('+showDate+')';
    }else{
        showDate = $api.getStorage('missionDay');
        titleStr = '今日考勤数据';
    }
    var className1 = 'aui-bar-danger';
    var className2 = 'aui-btn-danger';
    header = $api.byId('misHeader');
    $api.addCls(header, className1);
    $api.addCls($api.byId('backBtn'), className2);
    $api.html($api.byId('zhName'), titleStr);
    fixStatusBar(header);
    headerHeight = $api.offset($api.byId('misHeader')).h;
    if(isToday == 1){
        getTime();  
    }else{
        $api.addCls($api.byId('showTime'), 'aui-hidden');
    }
};
</script>
</html>