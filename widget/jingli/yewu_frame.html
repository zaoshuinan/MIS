<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
</head>
<body>
    <div class="aui-content-padded icons" style="padding-top: 20px;">
        <ul class="aui-grid-nine" id="viewBox1">
            <li class="aui-col-xs-4 aui-text-center" tapmode onclick="openYuyue()"><img src="../image/yuyue.png" style="width:60px"><p>预约</p></li>
            <li class="aui-col-xs-4 aui-text-center" tapmode onclick="openMaizhong()"><img src="../image/maizhong.png" style="width:60px"><p>买钟</p></li>
            <li class="aui-col-xs-4 aui-text-center" tapmode onclick="openQingjia()"><img src="../image/qingjia1.png" style="width:60px"><p>请假</p></li>
        </ul>
    </div>
    <div class="aui-content-padded icons" style="padding-top: 20px;">
        <ul class="aui-grid-nine" id="viewBox">
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openKaika()"><img src="../image/kaika.png" style="width:60px"><p>开卡</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openChongzhi()"><img src="../image/chongzhi.png" style="width:60px"><p>充值</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openDetail(5)"><img src="../image/jishi.png" style="width:60px"><p>查看技师</p></li>
            <li class="aui-col-xs-6 aui-text-center" tapmode onclick="openDetail(6)"><img src="../image/zhongfang2.png" style="width:60px"><p>开启房间</p></li>
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/mis.js" ></script>
<script type="text/javascript" src="../script/laytpl.js" ></script>
<script type="text/javascript">
var serviceJson = $api.getStorage('cacheService');
var cacheCompany = $api.getStorage('cacheCompany');
var companyFanweiStr = cacheCompany.company_fanwei;
var companyFanweiArr = companyFanweiStr.split(',');
function openMaizhong(){
    api.actionSheet({
        destructiveTitle: '我要买钟',
        buttons: ['买钟历史']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                addMaizhong()
            }
            if(ret.buttonIndex == 2){
                maizhongHistroy()
            }
        }
    });
}
function addMaizhong(){
    api.confirm({
        title: '确认信息',
        msg: '你确认需要买钟吗？',
        buttons: ['确定', '取消']
    }, function(ret, err) {
        if (ret) {
            //alert(JSON.stringify(ret));
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'addMaizhong',
                    url: './maizhong_win.html',
                    pageParam: {
                        name: 'value'
                    }
                });
            }
        }
    });
}
function maizhongHistroy(){
    api.openWin({
        name: 'maizhongHistroy',
        url: './maizhong_histroy_win.html',
        pageParam: {
            name: 'value'
        }
    });
}
function openYuyue(){
    api.actionSheet({
        destructiveTitle: '新建预约',
        buttons: ['预约列表']
    }, function(ret, err){
        if( ret ){
            //alert( JSON.stringify( ret ) );
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'addYuyue',
                    url: './add_yuyue_win.html',
                    bounces: false,
                    slidBackEnabled:false,
                    pageParam: {key : 'value'}
                });
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'yuyueList',
                    url: './yuyue_list_win.html',
                    bounces: false,
                    slidBackEnabled:false,
                    pageParam: {key : 'value'}
                });
            }
        }else{
             //alert( JSON.stringify( err ) );
        }
    });
}
function openQingjia(){
    api.actionSheet({
        destructiveTitle: '休假申请',
        buttons: ['请假列表']
    }, function(ret, err) {
        if (ret) {
            if(ret.buttonIndex == 1){
                api.confirm({
                    msg: '确定要申请休假吗？',
                    buttons: ['确定', '取消']
                }, function(ret, err) {
                    if (ret) {
                        if(ret.buttonIndex == 1){
                            api.openWin({
                                name: 'addQingjia',
                                url: './add_qingjia_win.html',
                                pageParam: {
                                    userType: 0
                                }
                            });
                        }
                    }
                }); 
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'qingjiaHistroy',
                    url: './qingjia_histroy_win.html',
                    pageParam: {
                        userType: 0
                    }
                });
            }
        } 
    });
}
function openKaika(){
    api.actionSheet({
        destructiveTitle: '新建会员',
        buttons: ['开卡列表']
    }, function(ret, err){
        if( ret ){
            //alert( JSON.stringify( ret ) );
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'kaika',
                    url: './kaika_win.html',
                    bounces: false,
                    slidBackEnabled:false,
                    pageParam: {key : 'value'}
                });
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                        name: 'kaikaList',
                        url: './kaika_list_win.html',
                        bounces: false,
                        slidBackEnabled:false,
                        pageParam: {key : 'value'}
                    });
            }
        }else{
             //alert( JSON.stringify( err ) );
        }
    });
}
function openChongzhi(){
    api.actionSheet({
        destructiveTitle: '新建充值',
        buttons: ['充值列表']
    }, function(ret, err){
        if( ret ){
            //alert( JSON.stringify( ret ) );
            if(ret.buttonIndex == 1){
                api.openWin({
                    name: 'chongzhi',
                    url: './chongzhi_win.html',
                    bounces: false,
                    slidBackEnabled:false,
                    pageParam: {key : 'value'}
                });
            }
            if(ret.buttonIndex == 2){
                api.openWin({
                    name: 'chongzhiList',
                    url: './chongzhi_list_win.html',
                    bounces: false,
                    slidBackEnabled:false,
                    pageParam: {key : 'value'}
                });
            }
        }else{
             //alert( JSON.stringify( err ) );
        }
    });
}
function openDetail(index){
    var yewuCode = companyYewuArr[index];
    if(index ==5 || index ==6){
        if(index == 5){
            api.openWin({
                name: 'checkJishi',
                url: './check_jishi_win.html',
                pageParam: {
                    name: 'test'
                }
            });
        }
        if(index == 6){
            var roomTypeNameArr = new Array();
            var roomTypeIdArr = new Array();
            for(var i = 0; i < companyFanweiArr.length; i++){
                var fanweiId = companyFanweiArr[i];
                var thisName = companyYewuNameArr[fanweiId];
                roomTypeNameArr[i] = thisName;
                roomTypeIdArr[i] = fanweiId;
            }
            api.actionSheet({
                buttons : roomTypeNameArr
            }, function(ret, err) {
                if(ret.buttonIndex <= roomTypeNameArr.length){
                    var indexNum = ret.buttonIndex - 1;
                    var roomTypeId = roomTypeIdArr[indexNum];
                    api.openWin({
                        name: 'checkRoom',
                        url: './check_room_win.html',
                        pageParam: {
                            fanweiId: roomTypeId
                        }
                    });
                }
            });
           
        }
    }else{
        if(index == 0){
            var listJson = serviceJson.muzu;        
        }
        if(index == 1){
            var listJson = serviceJson.anmo;        
        }
        if(index == 2){
            var listJson = serviceJson.sangna;        
        }
        if(index == 3){
            var listJson = serviceJson.qipai;        
        }
        if(index == 4){
            var listJson = serviceJson.kefang;        
        }
        //alert(JSON.stringify(listJson));
        //return false;
        if(!listJson){
            api.toast({
                msg: '该项目下没有具体服务',
                duration: 2000,
                location: 'bottom'
            });
        }else{
            //alert(listJson.nameList.length);
            api.actionSheet({
                buttons : listJson.nameList
            }, function(ret, err) {
                if(ret.buttonIndex <= listJson.nameList.length){
                    var indexNum = ret.buttonIndex - 1;
                    var fuwuDetailId = listJson.idList[indexNum];
                    //alert(ret.buttonIndex);
                    //alert(listJson.idList)
                    //return false;
                    //alert(fuwuDetailId);
                    //alert(index);
                    api.openWin({
                        name: 'fuwuDingdan',
                        url: './fuwu_dingdan_win.html',
                        bounces: false,
                        slidBackEnabled:false,
                        pageParam: {
                            'fuwuDetailId':fuwuDetailId,
                            'fanweiId':index,
                            'dingdanId':''
                        }
                    });
                }
            });
        }
    }  
}
function buildListByTpl(){
    var viewBox = $api.byId('viewBox');
    var tplBox = $api.byId('tplBox');
    var tplStr = $api.html(tplBox);
    laytpl(tplStr).render(data, function(htmlStr){
        $api.html(viewBox, htmlStr);
    });
}
apiready = function(){
    //alert(JSON.stringify(serviceJson));
    api.parseTapmode();
    //buildButtons();
}
    
</script>
</html>